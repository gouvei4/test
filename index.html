<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AR Finance com Marcador</title>

  <!-- A-Frame primeiro -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <!-- AR.js depois -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    #switchButton {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 9999;
      padding: 8px 12px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Cena AR -->
  <a-scene embedded arjs>
    <!-- Usa o marcador Hiro (padrão do AR.js) -->
    <a-marker preset="hiro">
      <a-entity id="chart-container" position="0 0 0"></a-entity>
      <a-entity id="pie-chart" visible="false" position="0 0 0"></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <!-- Botão de alternar gráficos -->
  <button id="switchButton">Trocar Gráfico</button>

  <script>
    AFRAME.registerComponent('generate-bar-chart', {
      schema: { values: { type: 'array', default: [45, 80, 60, 30, 90] } },
      init: function () {
        const container = this.el;
        const data = this.data.values;
        data.forEach((value, index) => {
          const bar = document.createElement('a-box');
          bar.setAttribute('position', `${index * 0.6} ${value / 40} 0`);
          bar.setAttribute('height', value / 20);
          bar.setAttribute('width', 0.4);
          bar.setAttribute('depth', 0.4);
          bar.setAttribute('color', '#4CAF50');
          container.appendChild(bar);
        });
      }
    });

    AFRAME.registerComponent('generate-pie-chart', {
      schema: { values: { type: 'array', default: [45, 80, 60, 30, 90] } },
      init: function () {
        const container = this.el;
        const data = this.data.values;
        const total = data.reduce((sum, val) => sum + val, 0);
        let startAngle = 0;
        data.forEach((value, index) => {
          const slice = document.createElement('a-ring');
          const angle = (value / total) * 360;
          const rotation = startAngle + angle / 2;
          slice.setAttribute('theta-start', startAngle);
          slice.setAttribute('theta-length', angle);
          slice.setAttribute('radius-inner', 0.3);
          slice.setAttribute('radius-outer', 0.8);
          slice.setAttribute('rotation', `-90 0 ${rotation}`);
          slice.setAttribute('color', getColor(index));
          container.appendChild(slice);
          startAngle += angle;
        });
      }
    });

    function getColor(index) {
      const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'];
      return colors[index % colors.length];
    }

    const dadosFinanceiros = [45, 80, 60, 30, 90];
    const barContainer = document.querySelector('#chart-container');
    const pieContainer = document.querySelector('#pie-chart');

    barContainer.setAttribute('generate-bar-chart', `values: ${JSON.stringify(dadosFinanceiros)}`);
    pieContainer.setAttribute('generate-pie-chart', `values: ${JSON.stringify(dadosFinanceiros)}`);

    document.getElementById('switchButton').addEventListener('click', () => {
      const isBarVisible = barContainer.getAttribute('visible') !== false;
      barContainer.setAttribute('visible', !isBarVisible);
      pieContainer.setAttribute('visible', isBarVisible);
    });
  </script>
</body>
</html>
